digraph compliance_basics {
    graph [fontname = "Roboto,BlinkMacSystemFont,Helvetica,Arial,sans-serif"];
    node [fontname = "Roboto,BlinkMacSystemFont,Helvetica,Arial,sans-serif"];
    edge [fontname = "Roboto,BlinkMacSystemFont,Helvetica,Arial,sans-serif"];

    compound=true;
    graph[labeljust="l", fontsize=20];

    subgraph cluster_header {
        style="invis";
        title[
            shape="none"
            label="compliantkubernetes.io"
            target="_top"
            fontcolor="#4651b4"
            URL="https://compliantkubernetes.io"
            width=11
        ];
    }

    subgraph cluster_regulations {
        label="Regulations";
        node[width=1, shape=box, style=rounded];

        HIPAA[URL="https://www.cdc.gov/phlp/publications/topic/hipaa.html"];
        PDL[URL="https://www.riksdagen.se/sv/dokument-lagar/dokument/svensk-forfattningssamling/patientdatalag-2008355_sfs-2008-355"];
        GDPR[URL="https://gdpr.eu/"];
        CCPA[URL="https://oag.ca.gov/privacy/ccpa"];
        FFFS[URL="https://www.fi.se/en/our-registers/search-fffs/2014/20145/"];
    }

    subgraph cluster_isms {
        label="Information Security Standards"
        node[target="_blank"];
        node[width=1, shape=box, style=rounded];

        iso27k[label="ISO 27001", URL="https://www.isms.online/iso-27001/"];
        soc2[label="SOC 2", URL="https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report.html"];
        pcidss[label="PCI DSS", URL="https://www.pcisecuritystandards.org/"];
    }

    graph[width="4pt"];
    subgraph cluster_policies {
        label="Policies"
        node[width=1, shape=circle, fixedsize=true];

        { HIPAA, PDL, GDPR, CCPA, FFFS } -> Controls
        { iso27k, soc2, pcidss } -> Controls

        // Special node for alignment
        controls2[width=0, height=0, margin=0, style="invis", label=""];

        node[width=1, shape=box, style=rounded];
        node[target="_top"];
        Controls -> {
            access[label="Access\ncontrol"]
            "Logging"
            "Backups"[
                URL="/ciso-guide/backup/",
                fontcolor="#4651b4"
            ];
            continuous[
                label="Continuous\ncompliance",
                URL="/ciso-guide/policy-as-code/",
                fontcolor="#4651b4",
                fontsize=12
            ]
            vulnerability[label="Vulnerability\nmanagement",fontsize=12]
            intrusion[
                label="Intrusion\ndetection",
                URL="/ciso-guide/intrusion-detection/",
                fontcolor="#4651b4",
            ]
            network[label="Network\nsecurity"]
            crypto[
                label="Use of\ncryptography",
                URL="/ciso-guide/cryptography/",
                fontcolor="#4651b4",
                fontsize=12,
            ]
            supplier[label="Supplier\nmanagement",fontsize=12]
        }
    }

    subgraph cluster_implementation {
        label="Compliant Kubernetes"

        node[
            shape=none,
            label="",
            width=1,
            height=1.4,
            labelloc=b,
            fixedsize=true,
            imagescale=true,
            imagepos=tc,
            fontsize=16,
            target="_blank"
        ];

        access -> { dex[
            image="logos/project-icons/dex.svg",
            label="Dex",
            URL="https://dexidp.io/"
        ] }
        "Backups" -> { velero[
            image="logos/project-icons/velero.svg",
            label="Velero",
            URL="https://velero.io"
        ] }
        "Logging" -> { elasticsearch[
            image="logos/project-icons/opendistro.svg",
            label="Elasticsearch",
            URL="https://opendistro.github.io/for-elasticsearch/"
            fontsize=14
        ] }
        continuous -> { opa[
            image="logos/project-icons/opa.svg",
            label="OPA",
            URL="https://open-policy-agent.github.io/gatekeeper/website/docs/"
        ] }
        vulnerability
            //-> { harbor[image="logos/harbor.png"] }
            -> { trivy[
            image="logos/project-icons/trivy.svg"
            label="Trivy"
            URL="https://github.com/aquasecurity/trivy"
        ] }
        intrusion -> { falco[
            image="logos/project-icons/falco.svg",
            label="Falco",
            URL="https://falco.org/",
        ] }
        network -> { calico[
            image="logos/project-icons/calico.svg",
            label="Calico",
            URL="https://www.projectcalico.org/"
        ] }
        crypto -> { certmanager[
            image="logos/project-icons/cert-manager.svg"
            label="Cert Manager"
            URL="https://cert-manager.io/"
            fontsize=14
        ] }
    }

    subgraph cluster_audit {
        label="Compliant Kubernetes Dashboard"
        node[
            shape=none,
            label="",
            width=1,
            height=1.4,
            labelloc=b,
            fixedsize=true,
            imagescale=true,
            imagepos=tc,
            fontsize=16,
            target="_blank"
        ];
        prometheus[
            image="logos/project-icons/prometheus.svg",
            label="Prometheus",
            fontsize=12,
            URL="https://prometheus.io/"
        ]
        grafana[
            image="logos/project-icons/grafana.svg"
            label="Grafana",
            URL="https://github.com/grafana/grafana"
        ]

        edge[lhead=cluster_audit]
        dex->prometheus
        elasticsearch->grafana

        // Alignment: We create a lot of invisible nodes "auditNA*" for alignment.
        velero->auditNA1
        opa->auditNA2
        trivy->auditNA3
        falco->auditNA4
        calico->auditNA5
        certmanager->auditNA6
    }

    subgraph cluster_provider {
        label="Compliant Cloud Provider"

        node[shape=none, label="", width=1, height=1, fixedsize=true, imagescale=true];
        edge[style=invis];

        // Special node to attach supplier management to.
        cloud_provider[width=0, height=0, margin=0];

        cloud_provider -> {
            aws[image="logos/cloud-providers/aws.png"];
            azure[image="logos/cloud-providers/azure.png"];
            citycloud[image="logos/cloud-providers/citycloud.png"]
            exoscale[image="logos/cloud-providers/exoscale.png"]
            safespring[image="logos/cloud-providers/safespring.png"]
            openstack[image="logos/cloud-providers/openstack.png"]
            byovm[label="Bring\nYour Own\nVMs",shape=box]
            byom[label="Bring\nYour Own\nMetal",shape=box]
        }
    }

    // Make sure the rank of cloud providers is below those of
    // Compliant Kubernetes components.
    {
        node[shape=none, label="", height="0", width="0"];
        edge[arrowhead=none];
        supplier -> supplier2 -> supplier3;
        supplier3 -> cloud_provider[arrowhead=normal, lhead=cluster_provider];
    }

    // Alignment
    edge[weight=1000,style="invis"];

    FFFS -> controls2 -> access -> dex;
    cloud_provider -> byom;
    title -> HIPAA;
}
